{{!-- Hereda de main.handlebars --}}
<section class="portada">
    <div class="titulo">
        <h3 class="tracking-in-contract">InaYoga !!</h3>
    </div>
</section>
<section class="nucleo">
    <h2 class="subtitulos">Nuestros productos</h2>
    {{#if products.length}}
        <div class="articulos-lectura">
            {{#each products}}
                <div class="card articulo-info" style="margin-bottom: 1rem;">
                    <h4>{{title}}</h4>
                    <p>{{description}}</p>
                    <p><strong>Precio:</strong> ${{price}}</p>
                    <p><strong>Stock:</strong> {{stock}}</p>
                    <p><strong>Categoría:</strong> {{category}}</p>
                    {{#if onSale}}
                        <span style="color: green; font-weight: bold;">¡En oferta!</span>
                    {{/if}}
                    {{#if thumbnails.length}}
                        <div>
                            {{#each thumbnails}}
                                <img src="{{this}}" alt="Imagen de {{../title}}" style="max-width: 100px;">
                            {{/each}}
                        </div>
                    {{/if}}
                </div>
            {{/each}}
        </div>
    {{else}}
        <p>No hay productos disponibles en este momento.</p>
    {{/if}}
</section>
<section>
    <h2>Agregar producto</h2>
    <form action="/add-product" method="POST">
        <input type="text" name="title" placeholder="Título" required>
        <input type="text" name="description" placeholder="Descripción" required>
        <input type="number" name="price" placeholder="Precio" required>
        <input type="number" name="stock" placeholder="Stock" required>
        <input type="text" name="category" placeholder="Categoría" required>
        <input type="checkbox" name="onSale"> En oferta
        <button type="submit">Agregar</button>
    </form>
</section>
<section>
    <h2>Lista de productos</h2>
    <ul>
        {{#each products}}
            <li>
                <strong>{{title}}</strong> - ${{price}}
                <button class="add-to-cart-btn" data-id="{{_id}}">Agregar al carrito</button>
            </li>
        {{/each}}
    </ul>

    <div>
        {{#if prevLink}}
            <a href="{{prevLink}}">Anterior</a>
        {{/if}}
        Página {{page}} de {{totalPages}}
        {{#if nextLink}}
            <a href="{{nextLink}}">Siguiente</a>
        {{/if}}
    </div>

    <script>
        // Suponiendo que tienes el ID del carrito en localStorage o en una variable global
        const cartId = localStorage.getItem('cartId') || 'ID_DEL_CARRITO';

        document.querySelectorAll('.add-to-cart-btn').forEach(btn => {
            btn.addEventListener('click', async () => {
                const productId = btn.dataset.id;
                const res = await fetch(`/api/carts/${cartId}/products/${productId}`, {
                    method: 'POST'
                });
                if (res.ok) {
                    alert('Producto agregado al carrito');
                } else {
                    alert('Error al agregar producto');
                }
            });
        });
    </script>
</section>
<footer class="final">
    <div class="menu-final">
        <ul class="link">
            <li><a href="/">Inicio</a></li>
        </ul>
    </div>
</footer>